<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<<<<<<< HEAD
    <title> Project Agent</title>
=======
    <title>Projura Project Ideas AI Agent</title>
>>>>>>> 68dc3d1 (Title Changed)
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #e94560 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff6b6b, #ffd93d, #6bcf7f, #4ecdc4, #ff6b9d);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: colorShift 8s ease infinite;
            text-shadow: none;
            font-weight: 900;
            letter-spacing: 2px;
        }

        @keyframes colorShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            color: #f2f2f5;
        }

        .features-badge {
            display: inline-block;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(107, 199, 127, 0.2));
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9em;
            font-weight: 600;
            color: white;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(10px);
        }

        .features-badge:hover {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.5), rgba(107, 199, 127, 0.5));
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border-color: white;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            flex: 1;
            min-width: 180px;
            padding: 15px 20px;
            background: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            color: #333;
        }

        .tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ffd93d, #6bcf7f, #4ecdc4);
            background-size: 200% 200%;
            transition: left 0.4s ease;
            z-index: -1;
        }

        .tab-button:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.2);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2, #ff6b6b, #ffd93d);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
            color: white;
            box-shadow: 0 8px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-top: 4px solid transparent;
            border-image: linear-gradient(135deg, #ff6b6b, #ffd93d, #6bcf7f, #4ecdc4) 1;
        }

        .tab-content.active {
            display: block;
            animation: fadeInScale 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.98);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .label-with-badge {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-badge {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: normal;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: white;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1), inset 0 0 10px rgba(255, 107, 107, 0.05);
            transform: translateY(-2px);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .submit-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffd93d 33%, #6bcf7f 66%, #4ecdc4 100%);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .submit-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .submit-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        .submit-btn:active::after {
            width: 300px;
            height: 300px;
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.05), rgba(78, 205, 196, 0.05));
            border-radius: 10px;
            display: none;
            border: 2px solid rgba(255, 107, 107, 0.2);
            backdrop-filter: blur(10px);
        }

        .result-container.show {
            display: block;
            animation: slideInUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-content {
            white-space: pre-wrap;
            line-height: 1.8;
            color: #333;
        }

        .tool-results {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(78, 205, 196, 0.1));
            border-radius: 8px;
            border-left: 4px solid #6bcf7f;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .tool-results:hover {
            border-left-color: #4ecdc4;
            box-shadow: 0 8px 20px rgba(107, 199, 127, 0.2);
            transform: translateX(3px);
        }

        .tool-results h4 {
            margin-bottom: 10px;
            color: #667eea;
            font-weight: 700;
        }

        .github-project {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.95));
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .github-project:hover {
            transform: translateX(8px) scale(1.02);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.2);
            border-left-color: #ffd93d;
        }

        .github-project h5 {
            margin-bottom: 5px;
            color: #667eea;
            font-weight: 700;
        }

        .github-project p {
            font-size: 0.9em;
            color: #666;
            margin: 5px 0;
        }

        .budget-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .budget-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-top: 3px solid transparent;
            border-image: linear-gradient(135deg, #ff6b6b, #ffd93d, #6bcf7f) 1;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }

        .budget-item:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.05), rgba(107, 199, 127, 0.05));
        }

        .budget-item h5 {
            color: #667eea;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .budget-item .amount {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(135deg, #ff6b6b, #ffd93d, #6bcf7f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .skill-meter {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .skill-meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f, #4ecdc4);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .info-box {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(107, 199, 127, 0.1));
            border-left: 4px solid #ff6b6b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .info-box:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.2);
            border-left-color: #ffd93d;
        }

        .info-box p {
            margin: 0;
            color: #333;
            font-weight: 500;
        }

        .session-info {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-btn {
            background: white;
            color: #000c3f;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .session-btn:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            color: white;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Projura - Project Agent</h1>
            <p class="subtitle">AI-Powered Project Planning with Advanced Tools</p>
            <br>
            <div>
                <span class="features-badge"> Web Search</span>
                <span class="features-badge"> GitHub Integration</span>
                <span class="features-badge"> Budget Calculator</span>
                <span class="features-badge"> Skill Assessment</span>
                <span class="features-badge"> Session Memory</span>
            </div>
        </header>

        <div class="session-info">
            <span>Session Active | Interactions: <span id="interaction-count">0</span></span>
            <div style="display: flex; gap: 10px;">
                <a href="/history" class="session-btn" style="text-decoration: none;">View Full History </a>
                <button class="session-btn" style="background: #ff4444;" onclick="handleLogout()">Logout</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('ideas', this)">
                Generate Ideas
            </button>
            <button class="tab-button" onclick="switchTab('roadmap', this)">
                Create Roadmap
            </button>
            <button class="tab-button" onclick="switchTab('feasibility', this)">
                Feasibility Study
            </button>
            <button class="tab-button" onclick="switchTab('tools', this)">
                Project Tracker
            </button>
        </div>

        <!-- Generate Ideas Tab -->
        <div id="ideas-tab" class="tab-content active">
            <div class="info-box">
                <p>AI-powered project ideas with real-time tech trend research!</p>
            </div>
            <form id="ideas-form">
                <div class="form-group">
                    <label for="domain">Domain: </label>
                    <input type="text" id="domain" required
                        placeholder="e.g., Web Development, AI/ML, Mobile Apps, IoT">
                </div>

                <div class="form-group">
                    <label for="skill_level">Skill Level: </label>
                    <select id="skill_level" required>
                        <option value="">Select skill level</option>
                        <option value="Beginner">Beginner</option>
                        <option value="Intermediate">Intermediate</option>
                        <option value="Advanced">Advanced</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="constraints">Additional Constraints (Optional)</label>
                    <textarea id="constraints"
                        placeholder="e.g., Must be completed in 2 months, No budget for cloud services"></textarea>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="use_trends" checked>
                        <label for="use_trends" style="margin: 0;">
                            <span class="tool-badge">WEB SEARCH</span> Include latest tech trends research
                        </label>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Generate Ideas</button>
            </form>

            <div id="ideas-result" class="result-container">
                <h3>Generated Project Ideas:</h3>
                <div class="result-content" id="ideas-content"></div>
            </div>
        </div>

        <!-- Create Roadmap Tab -->
        <div id="roadmap-tab" class="tab-content">
            <div class="info-box">
                <p>Get detailed roadmap with GitHub project research!</p>
            </div>
            <form id="roadmap-form">
                <div class="form-group">
                    <label for="project_desc">Project Description *</label>
                    <textarea id="project_desc" required
                        placeholder="Describe your project in detail. Include goals, target audience, key features."></textarea>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="check_similar" checked>
                        <label for="check_similar" style="margin: 0;">
                            <span class="tool-badge">GITHUB</span> Search for similar projects on GitHub
                        </label>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Create Roadmap</button>
            </form>

            <div id="roadmap-result" class="result-container">
                <h3>Project Roadmap:</h3>
                <div id="github-projects"></div>
                <div class="result-content" id="roadmap-content"></div>
            </div>
        </div>

        <!-- Assess Feasibility Tab -->
        <div id="feasibility-tab" class="tab-content">
            <div class="info-box">
                <p> Comprehensive feasibility analysis with skill assessment and budget calculation!</p>
            </div>
            <form id="feasibility-form">
                <div class="form-group">
                    <label for="feas_project_desc">Project Description *</label>
                    <textarea id="feas_project_desc" required placeholder="Describe your project idea"></textarea>
                </div>

                <div class="two-column">
                    <div class="form-group">
                        <label for="available_time">Available Time *</label>
                        <input type="text" id="available_time" required placeholder="e.g., 3 months, 10 hours per week">
                    </div>

                    <div class="form-group">
                        <label for="project_type">Project Type: </label>
                        <select id="project_type">
                            <option value="web_development">Web Development</option>
                            <option value="mobile_app">Mobile App</option>
                            <option value="ai_ml">AI/ML</option>
                            <option value="data_science">Data Science</option>
                            <option value="game_development">Game Development</option>
                            <option value="iot">IoT</option>
                            <option value="blockchain">Blockchain</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <div class="label-with-badge">
                        <label for="current_skills">Current Skills * (comma-separated)</label>
                        <span class="tool-badge">SKILL TOOL</span>
                    </div>
                    <textarea id="current_skills" required
                        placeholder="e.g., Python, JavaScript, React, SQL, Git"></textarea>
                </div>

                <div class="form-group">
                    <label for="budget">Budget</label>
                    <select id="budget">
                        <option value="Limited">Limited ($0-100)</option>
                        <option value="Moderate">Moderate ($100-500)</option>
                        <option value="Flexible">Flexible ($500+)</option>
                    </select>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="check_github_feas" checked>
                        <label for="check_github_feas" style="margin: 0;">
                            <span class="tool-badge">GITHUB</span> Search for similar projects on GitHub
                        </label>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Assess Feasibility</button>
            </form>

            <div id="feasibility-result" class="result-container">
                <h3>Feasibility Assessment:</h3>

                <!-- Skill Analysis -->
                <div id="skill-analysis" class="tool-results" style="display:none;">
                    <h4> Skill Analysis</h4>
                    <div class="skill-meter">
                        <div class="skill-meter-fill" id="skill-meter-fill" style="width: 0%;">0%</div>
                    </div>
                    <div id="skill-details"></div>
                </div>

                <!-- Budget Analysis -->
                <div id="budget-analysis" class="tool-results" style="display:none;">
                    <h4>Budget Breakdown</h4>
                    <div class="budget-breakdown" id="budget-breakdown"></div>
                </div>

                <!-- Main Assessment -->
                <div class="result-content" id="feasibility-content"></div>
            </div>
        </div>

        <!-- Direct Tools Tab -->
        <div id="tools-tab" class="tab-content">
            <div class="info-box">
                <p>Track your projects with AI-powered analysis and automated milestone tracking!</p>
            </div>

            <!-- Statistics Dashboard -->
            <div class="stats-dashboard"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <div class="stat-box"
                    style="background: #e3f2fd; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #1976d2; margin-bottom: 10px;">Total Projects</h4>
                    <div class="stat-number" id="total-projects"
                        style="font-size: 2.5em; font-weight: bold; color: #1565c0;">0</div>
                </div>
                <div class="stat-box"
                    style="background: #fff3e0; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #f57c00; margin-bottom: 10px;">In Progress</h4>
                    <div class="stat-number" id="in-progress-projects"
                        style="font-size: 2.5em; font-weight: bold; color: #e65100;">0</div>
                </div>
                <div class="stat-box"
                    style="background: #e8f5e9; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #388e3c; margin-bottom: 10px;">Completed</h4>
                    <div class="stat-number" id="completed-projects"
                        style="font-size: 2.5em; font-weight: bold; color: #2e7d32;">0</div>
                </div>
                <div class="stat-box"
                    style="background: #f3e5f5; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="color: #7b1fa2; margin-bottom: 10px;">Milestones Done</h4>
                    <div class="stat-number" id="completed-milestones"
                        style="font-size: 2.5em; font-weight: bold; color: #6a1b9a;">0</div>
                </div>
            </div>

            <!-- Add New Project Section -->
            <div style="margin-bottom: 30px;">
                <button class="submit-btn" onclick="toggleProjectForm()" style="margin-bottom: 20px;">
                    ‚ûï Add New Project
                </button>

                <div id="new-project-form"
                    style="display: none; background: #f8f9fa; padding: 25px; border-radius: 10px;">
                    <h3 style="margin-bottom: 20px;">Create New Project</h3>
                    <form id="create-project-form">
                        <div class="form-group">
                            <label for="tracker-project-name">Project Name *</label>
                            <input type="text" id="tracker-project-name" required
                                placeholder="e.g., E-commerce Website">
                        </div>

                        <div class="form-group">
                            <label for="tracker-description">Description *</label>
                            <textarea id="tracker-description" required
                                placeholder="Describe your project goals, features, and target audience"></textarea>
                        </div>

                        <div class="two-column">
                            <div class="form-group">
                                <label for="tracker-domain">Domain *</label>
                                <select id="tracker-domain" required>
                                    <option value="">Select domain</option>
                                    <option value="Web Development">Web Development</option>
                                    <option value="Mobile App">Mobile App</option>
                                    <option value="AI/ML">AI/ML</option>
                                    <option value="Data Science">Data Science</option>
                                    <option value="Game Development">Game Development</option>
                                    <option value="DevOps">DevOps</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="tracker-skill-level">Your Skill Level *</label>
                                <select id="tracker-skill-level" required>
                                    <option value="">Select level</option>
                                    <option value="Beginner">Beginner</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                </select>
                            </div>
                        </div>

                        <div class="two-column">
                            <div class="form-group">
                                <label for="tracker-time">Available Time *</label>
                                <input type="text" id="tracker-time" required
                                    placeholder="e.g., 3 months, 10 hours/week">
                            </div>

                            <div class="form-group">
                                <label for="tracker-budget">Budget</label>
                                <select id="tracker-budget">
                                    <option value="Limited">Limited ($0-100)</option>
                                    <option value="Moderate">Moderate ($100-500)</option>
                                    <option value="Flexible">Flexible ($500+)</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="submit-btn">Create & Analyze Project</button>
                            <button type="button" class="submit-btn" onclick="toggleProjectForm()"
                                style="background: #666;">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Projects List -->
            <div id="projects-list">
                <h3>Your Projects</h3>
                <div id="projects-container" style="margin-top: 20px;">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        No projects yet. Create one to get started!
                    </p>
                </div>
            </div>

            <!-- Project Details Modal (will be shown when clicking on a project) -->
            <div id="project-details-modal"
                style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
                <div
                    style="background: white; margin: 50px auto; max-width: 900px; border-radius: 15px; padding: 30px; position: relative;">
                    <button onclick="closeProjectDetails()"
                        style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5em; cursor: pointer;">‚úñ</button>

                    <div id="project-details-content">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- <div id="tools-tab" class="tab-content">
            <div class="info-box">
                <p>üõ†Ô∏è Use individual tools directly for quick calculations and research!</p>
            </div>

            <h3>üîç GitHub Project Search</h3>
            <form id="github-search-form">
                <div class="form-group">
                    <label for="github_query">Search Query</label>
                    <input type="text" id="github_query" placeholder="e.g., todo app react">
                </div>
                <button type="submit" class="submit-btn">Search GitHub</button>
            </form>
            <div id="github-search-results" class="result-container"></div>

            <hr style="margin: 30px 0;">

            <h3>üí∞ Budget Calculator</h3>
            <form id="budget-calc-form">
                <div class="two-column">
                    <div class="form-group">
                        <label for="calc_project_type">Project Type</label>
                        <select id="calc_project_type">
                            <option value="web_development">Web Development</option>
                            <option value="mobile_app">Mobile App</option>
                            <option value="ai_ml">AI/ML</option>
                            <option value="data_science">Data Science</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="calc_duration">Duration (months)</label>
                        <input type="number" id="calc_duration" value="3" min="1">
                    </div>
                </div>
                <button type="submit" class="submit-btn">Calculate Budget</button>
            </form>
            <div id="budget-calc-results" class="result-container"></div>

            <hr style="margin: 30px 0;">

            <h3>üìä Skill Assessment</h3>
            <form id="skill-assess-form">
                <div class="form-group">
                    <label for="assess_current">Your Skills (comma-separated)</label>
                    <input type="text" id="assess_current" placeholder="Python, JavaScript, React">
                </div>
                <div class="form-group">
                    <label for="assess_required">Required Skills (comma-separated)</label>
                    <input type="text" id="assess_required" placeholder="Python, Django, PostgreSQL, Docker">
                </div>
                <button type="submit" class="submit-btn">Assess Skills</button>
            </form>
            <div id="skill-assess-results" class="result-container"></div>
        </div> -->
    </div>

    <script>
        let interactionCount = 0;
        let currentProjects = [];  // Declare at the top to avoid ReferenceError

        function formatAIResponse(text) {
    if (!text) return '';

    return text

        // Convert **bold** to <strong>
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')

        // Convert line breaks into <br>
        .replace(/\n/g, '<br>')

        // Add spacing after sentences for readability
        .replace(/\. /g, '.<br><br>')

        // Clean extra breaks
        .replace(/(<br>\s*){3,}/g,'<br><br>');
}


        function switchTab(tabName, buttonElement) {
            console.log('üîÑ Switching to tab:', tabName);

            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            const tabElement = document.getElementById(tabName + '-tab');
            if (!tabElement) {
                console.error('‚ùå Tab element not found:', tabName + '-tab');
                return;
            }

            tabElement.classList.add('active');
            buttonElement.classList.add('active');
            console.log('‚úÖ Tab activated:', tabName);

            // Load projects when tools/tracker tab is opened
            if (tabName === 'tools') {
                console.log('Loading projects for tools tab...');
                loadProjects();
            }
        }

        function updateInteractionCount() {
            interactionCount++;
            document.getElementById('interaction-count').innerHTML = interactionCount;
        }

        async function handleLogout() {
            try {
                const response = await fetch('/logout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();

                if (result.success) {
                    // Redirect to login page
                    window.location.href = result.redirect || '/';
                } else {
                    alert('Logout failed: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                // Force redirect to login even if there's an error
                window.location.href = '/';
            }
        }

        // Generate Ideas Form
        document.getElementById('ideas-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = e.target.querySelector('.submit-btn');
            const resultDiv = document.getElementById('ideas-result');
            const contentDiv = document.getElementById('ideas-content');

            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Generating...';

            contentDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Generating project ideas and researching trends...</div>';
            resultDiv.classList.add('show');

            const data = {
                domain: document.getElementById('domain').value,
                skill_level: document.getElementById('skill_level').value,
                constraints: document.getElementById('constraints').value,
                use_trends: document.getElementById('use_trends').checked
            };

            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    contentDiv.innerHTML = 'Error: Authentication token not found. Please log in again.';
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Generate Ideas';
                    return;
                }

                const response = await fetch('/generate_ideas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify(data)
                });

                if (response.status === 401) {
                    contentDiv.innerHTML = 'Error: Authentication failed. Please log in again.';
                } else {
                    const result = await response.json();
                    if (result.result) {
                        contentDiv.innerHTML = result.result;
                        updateInteractionCount();
                    } else {
                        contentDiv.innerHTML = 'Error: ' + (result.error || 'Unknown error occurred');
                    }
                }
            } catch (error) {
                contentDiv.innerHTML = 'Error: ' + error.message;
            }

            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Generate Ideas';
        });

        // Create Roadmap Form
        document.getElementById('roadmap-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = e.target.querySelector('.submit-btn');
            const resultDiv = document.getElementById('roadmap-result');
            const contentDiv = document.getElementById('roadmap-content');
            const githubDiv = document.getElementById('github-projects');

            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Creating...';

            contentDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Creating roadmap and searching GitHub...</div>';
            githubDiv.innerHTML = '';
            resultDiv.classList.add('show');

            const data = {
                project_description: document.getElementById('project_desc').value,
                check_similar: document.getElementById('check_similar').checked
            };

            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    contentDiv.innerHTML = 'Error: Authentication token not found. Please log in again.';
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Create Roadmap';
                    return;
                }

                const response = await fetch('/create_roadmap', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify(data)
                });

                if (response.status === 401) {
                    contentDiv.innerHTML = 'Error: Authentication failed. Please log in again.';
                } else {
                    const result = await response.json();

                    // Display similar projects
                    if (result.similar_projects && result.similar_projects.length > 0) {
                        let githubHtml = '<div class="tool-results"><h4>üíª Similar Projects on GitHub:</h4>';
                        result.similar_projects.forEach(proj => {
                            githubHtml += `
                                <div class="github-project">
                                    <h5>${proj.name} ‚≠ê ${proj.stars}</h5>
                                    <p>${proj.description}</p>
                                    <p><strong>Language:</strong> ${proj.language} | 
                                       <a href="${proj.url}" target="_blank">View on GitHub</a></p>
                                </div>
                            `;
                        });
                        githubHtml += '</div>';
                        githubDiv.innerHTML = githubHtml;
                    }

                    contentDiv.innerHTML = result.roadmap || result.error || 'Error: No roadmap generated';
                    updateInteractionCount();
                }
            } catch (error) {
                contentDiv.innerHTML = 'Error: ' + error.message;
            }

            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Create Roadmap';
        });

        // Assess Feasibility Form
        document.getElementById('feasibility-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = e.target.querySelector('.submit-btn');
            const resultDiv = document.getElementById('feasibility-result');
            const contentDiv = document.getElementById('feasibility-content');
            const skillDiv = document.getElementById('skill-analysis');
            const budgetDiv = document.getElementById('budget-analysis');
            const githubDiv = document.getElementById('github-projects');

            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Assessing...';

            contentDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Assessing feasibility with advanced tools...</div>';
            githubDiv.innerHTML = '';
            resultDiv.classList.add('show');

            const data = {
                project_description: document.getElementById('feas_project_desc').value,
                available_time: document.getElementById('available_time').value,
                current_skills: document.getElementById('current_skills').value,
                budget: document.getElementById('budget').value,
                project_type: document.getElementById('project_type').value
            };

            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    contentDiv.innerHTML = 'Error: Authentication token not found. Please log in again.';
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Assess Feasibility';
                    return;
                }

                const response = await fetch('/assess_feasibility', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify(data)
                });

                if (response.status === 401) {
                    contentDiv.innerHTML = 'Error: Authentication failed. Please log in again.';
                } else {
                    const result = await response.json();

                    // Search GitHub if checkbox is checked
                    if (document.getElementById('check_github_feas').checked) {
                        try {
                            const githubResponse = await fetch('/tools/github_search', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer ' + token
                                },
                                body: JSON.stringify({
                                    query: data.project_description.split(' ').slice(0, 3).join(' '),
                                    max_results: 5
                                })
                            });
                            const githubResult = await githubResponse.json();

                            if (githubResult.projects && githubResult.projects.length > 0) {
                                let githubHtml = '<div class="tool-results"><h4>üíª Similar Projects on GitHub:</h4>';
                                githubResult.projects.forEach(proj => {
                                    githubHtml += `
                                        <div class="github-project">
                                            <h5>${proj.name} ‚≠ê ${proj.stars}</h5>
                                            <p>${proj.description}</p>
                                            <p><strong>Language:</strong> ${proj.language} | 
                                               <a href="${proj.url}" target="_blank">View on GitHub</a></p>
                                        </div>
                                    `;
                                });
                                githubHtml += '</div>';
                                githubDiv.innerHTML = githubHtml;
                            }
                        } catch (githubError) {
                            console.warn('GitHub search failed:', githubError);
                        }
                    }

                    // Display skill analysis
                    if (result.skill_analysis) {
                        const skill = result.skill_analysis;
                        skillDiv.style.display = 'block';
                        document.getElementById('skill-meter-fill').style.width = skill.proficiency_score + '%';
                        document.getElementById('skill-meter-fill').innerHTML = skill.proficiency_score + '%';

                        document.getElementById('skill-details').innerHTML = `
                            <p><strong>Difficulty:</strong> ${skill.difficulty_level}</p>
                            <p><strong>Matched Skills:</strong> ${skill.matched_skills.join(', ') || 'None'}</p>
                            <p><strong>Missing Skills:</strong> ${skill.missing_skills.join(', ') || 'None'}</p>
                            <p><strong>Learning Time:</strong> ${skill.estimated_learning_time_weeks} weeks</p>
                            <p><strong>Recommendation:</strong> ${skill.recommendation}</p>
                        `;
                    }

                    // Display budget analysis
                    if (result.budget_analysis) {
                        const budget = result.budget_analysis;
                        budgetDiv.style.display = 'block';
                        document.getElementById('budget-breakdown').innerHTML = `
                            <div class="budget-item">
                                <h5>Total Budget</h5>
                                <div class="amount">$${budget.total_budget}</div>
                            </div>
                            <div class="budget-item">
                                <h5>Development</h5>
                                <div class="amount">$${budget.breakdown.development}</div>
                            </div>
                            <div class="budget-item">
                                <h5>Infrastructure</h5>
                                <div class="amount">$${budget.breakdown.infrastructure}</div>
                            </div>
                            <div class="budget-item">
                                <h5>Monthly Rate</h5>
                                <div class="amount">$${budget.monthly_burn_rate}</div>
                            </div>
                        `;
                    }

                    contentDiv.innerHTML = result.assessment || result.error || 'Error: No assessment generated';
                    updateInteractionCount();
                }
            } catch (error) {
                contentDiv.innerHTML = 'Error: ' + error.message;
            }

            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Assess Feasibility';
        });

        // GitHub Search Tool
        // document.getElementById('github-search-form').addEventListener('submit', async (e) => {
        //     e.preventDefault();
        //     const query = document.getElementById('github_query').value;
        //     const resultDiv = document.getElementById('github-search-results');

        //     resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Searching GitHub...</div>';
        //     resultDiv.classList.add('show');

        //     try {
        //         const response = await fetch('/tools/github_search', {
        //             method: 'POST',
        //             headers: { 'Content-Type': 'application/json' },
        //             body: JSON.stringify({ query, max_results: 5 })
        //         });

        //         const result = await response.json();
        //         let html = `<h4>${result.message}</h4>`;

        //         result.projects.forEach(proj => {
        //             html += `
        //                 <div class="github-project">
        //                     <h5>${proj.name} ‚≠ê ${proj.stars}</h5>
        //                     <p>${proj.description}</p>
        //                     <p><strong>Language:</strong> ${proj.language} | 
        //                        <a href="${proj.url}" target="_blank">View</a></p>
        //                 </div>
        //             `;
        //         });

        //         resultDiv.innerHTML = html;
        //     } catch (error) {
        //         resultDiv.innerHTML = 'Error: ' + error.message;
        //     }
        // });

        // Budget Calculator Tool
        // document.getElementById('budget-calc-form').addEventListener('submit', async (e) => {
        //     e.preventDefault();
        //     const resultDiv = document.getElementById('budget-calc-results');

        //     resultDiv.innerHTML = '<div class="loading">Calculating...</div>';
        //     resultDiv.classList.add('show');

        //     const data = {
        //         project_type: document.getElementById('calc_project_type').value,
        //         duration_months: parseInt(document.getElementById('calc_duration').value),
        //         team_size: 1
        //     };

        //     try {
        //         const response = await fetch('/tools/budget_calculator', {
        //             method: 'POST',
        //             headers: { 'Content-Type': 'application/json' },
        //             body: JSON.stringify(data)
        //         });

        //         const result = await response.json();

        //         resultDiv.innerHTML = `
        //             <h4>üí∞ Budget Estimate</h4>
        //             <div class="budget-breakdown">
        //                 <div class="budget-item">
        //                     <h5>Total Budget</h5>
        //                     <div class="amount">${result.total_budget}</div>
        //                 </div>
        //                 <div class="budget-item">
        //                     <h5>Development</h5>
        //                     <div class="amount">${result.breakdown.development}</div>
        //                 </div>
        //                 <div class="budget-item">
        //                     <h5>Infrastructure</h5>
        //                     <div class="amount">${result.breakdown.infrastructure}</div>
        //                 </div>
        //                 <div class="budget-item">
        //                     <h5>Tools & Licenses</h5>
        //                     <div class="amount">${result.breakdown.tools_and_licenses}</div>
        //                 </div>
        //                 <div class="budget-item">
        //                     <h5>Contingency (20%)</h5>
        //                     <div class="amount">${result.breakdown.contingency_20_percent}</div>
        //                 </div>
        //                 <div class="budget-item">
        //                     <h5>Monthly Burn Rate</h5>
        //                     <div class="amount">${result.monthly_burn_rate}</div>
        //                 </div>
        //             </div>
        //         `;
        //     } catch (error) {
        //         resultDiv.innerHTML = 'Error: ' + error.message;
        //     }
        // });

        // Skill Assessment Tool
        // document.getElementById('skill-assess-form').addEventListener('submit', async (e) => {
        //     e.preventDefault();
        //     const resultDiv = document.getElementById('skill-assess-results');

        //     resultDiv.innerHTML = '<div class="loading">Assessing...</div>';
        //     resultDiv.classList.add('show');

        //     const currentSkills = document.getElementById('assess_current').value.split(',').map(s => s.trim());
        //     const requiredSkills = document.getElementById('assess_required').value.split(',').map(s => s.trim());

        //     const data = {
        //         current_skills: currentSkills,
        //         required_skills: requiredSkills
        //     };

        //     try {
        //         const response = await fetch('/tools/skill_assessment', {
        //             method: 'POST',
        //             headers: { 'Content-Type': 'application/json' },
        //             body: JSON.stringify(data)
        //         });

        //         const result = await response.json();

        //         resultDiv.innerHTML = `
        //             <h4>üìä Skill Assessment Results</h4>
        //             <div class="skill-meter">
        //                 <div class="skill-meter-fill" style="width: ${result.proficiency_score}%;">
        //                     ${result.proficiency_score}%
        //                 </div>
        //             </div>
        //             <div style="margin-top: 15px;">
        //                 <p><strong>Difficulty Level:</strong> ${result.difficulty_level}</p>
        //                 <p><strong>Matched Skills:</strong> ${result.matched_skills.join(', ') || 'None'}</p>
        //                 <p><strong>Missing Skills:</strong> ${result.missing_skills.join(', ') || 'None'}</p>
        //                 <p><strong>Additional Skills You Have:</strong> ${result.additional_skills.join(', ') || 'None'}</p>
        //                 <p><strong>Estimated Learning Time:</strong> ${result.estimated_learning_time_weeks} weeks</p>
        //                 <p><strong>Recommendation:</strong> ${result.recommendation}</p>
        //             </div>
        //         `;
        //     } catch (error) {
        //         resultDiv.innerHTML = 'Error: ' + error.message;
        //     }
        // });

        // Toggle new project form
        function toggleProjectForm() {
            const form = document.getElementById('new-project-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        // Load statistics
        async function loadStatistics() {
            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    console.warn('‚ö†Ô∏è No token for statistics');
                    return;
                }

                console.log('üìà Loading statistics...');
                const response = await fetch('/api/statistics', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });

                if (!response.ok) {
                    console.error('‚ùå Statistics API error:', response.status);
                    return;
                }

                const stats = await response.json();
                console.log('‚úÖ Statistics loaded:', stats);

                document.getElementById('total-projects').innerHTML = stats.total_projects || 0;
                document.getElementById('in-progress-projects').innerHTML = stats.in_progress || 0;
                document.getElementById('completed-projects').innerHTML = stats.completed || 0;
                document.getElementById('completed-milestones').innerHTML = stats.completed_milestones || 0;
            } catch (error) {
                console.error('‚ùå Error loading statistics:', error);
            }
        }

        // Load projects list
        async function loadProjects() {
            try {
                console.log('üîç loadProjects() called');
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    console.error('‚ùå No authentication token found');
                    return;
                }

                console.log('üîê Token found, fetching projects...');
                const response = await fetch('/api/projects', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });

                if (!response.ok) {
                    console.error('‚ùå Projects API error:', response.status);
                    return;
                }

                const data = await response.json();
                console.log('‚úÖ Projects data received:', data);

                currentProjects = data.projects || [];
                console.log('üìã currentProjects set:', currentProjects);

                displayProjects(currentProjects);
                loadStatistics();
            } catch (error) {
                console.error('‚ùå Error loading projects:', error);
            }
        }

        // Display projects in list
        function displayProjects(projects) {
            console.log('üé® displayProjects() called with', projects.length, 'projects');
            const container = document.getElementById('projects-container');

            if (!container) {
                console.error('‚ùå projects-container element not found!');
                return;
            }

            if (projects.length === 0) {
                console.log('No projects to display');
                container.innerHTML = '<p style="text-align:center;color:#666;padding:40px;">No projects yet. Create one to get started!</p>';
                return;
            }

            let html = '';
            projects.forEach(project => {
                const statusColors = {
                    'planning': '#2196F3',
                    'in_progress': '#FF9800',
                    'completed': '#4CAF50',
                    'on_hold': '#9E9E9E'
                };

                html += `
            <div class="project-card" onclick="viewProjectDetails(${project.id})" style="background: #f8f9fa; padding: 20px; margin-bottom: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s; border-left: 5px solid ${statusColors[project.status] || '#666'};">
                <div style="display:flex;justify-content:space-between; align-items: start;">
                    <div style="flex:1;">
                        <h4 style="margin-bottom: 10px; color: #333;">${project.project_name}</h4>
                        <p style="color: #666;margin-bottom:10px;">${project.description.substring(0, 100)}...</p>
                        <div style="display: flex; gap: 15px;flex-wrap: wrap;">
                            <span style="background:#e3f2fd; padding: 5px 10px; border-radius: 15px; font-size: 0.85em;">${project.domain || 'N/A'}</span>
                            <span style="background:#fff3e0; padding: 5px 10px; border-radius: 15px; font-size: 0.85em;">${project.available_time || 'N/A'}</span>
                            <span style="background:#f3e5f5; padding: 5px 10px; border-radius: 15px; font-size: 0.85em;">${project.budget || 'N/A'}</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <span style="background: ${statusColors[project.status] || '#666'}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.85em;">
                            ${project.status.replace('_', ' ').toUpperCase()}
                        </span>
                    </div>
                </div>
            </div>
        `;
            });

            container.innerHTML = html;
        }

        // Setup event listeners when DOM is ready
        function setupEventListeners() {
            const createProjectForm = document.getElementById('create-project-form');

            if (createProjectForm) {
                createProjectForm.addEventListener('submit', handleCreateProject);
            } else {
                console.warn('‚ö†Ô∏è create-project-form not found, retrying in 500ms...');
                setTimeout(setupEventListeners, 500);
            }
        }

        // Handle create project form submission
        async function handleCreateProject(e) {
            e.preventDefault();
            console.log('‚úÖ Form submitted - creating project...');

            const submitBtn = e.target.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Creating & Analyzing...';

            const projectData = {
                project_name: document.getElementById('tracker-project-name').value,
                description: document.getElementById('tracker-description').value,
                domain: document.getElementById('tracker-domain').value,
                skill_level: document.getElementById('tracker-skill-level').value,
                available_time: document.getElementById('tracker-time').value,
                budget: document.getElementById('tracker-budget').value
            };

            console.log('Project data:', projectData);

            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    alert('Error: Authentication token not found. Please log in again.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Create & Analyze Project';
                    return;
                }

                console.log('üîê Token found:', token.substring(0, 20) + '...');

                const response = await fetch('/api/projects', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify(projectData)
                });

                console.log('Response status:', response.status);

                const result = await response.json();
                console.log('Response data:', result);

                if (result.success) {
                    alert('Project created and analyzed successfully!');
                    toggleProjectForm();
                    e.target.reset();
                    loadProjects();

                    // Show project details with analysis
                    viewProjectDetails(result.project_id);
                } else {
                    alert('Error: ' + (result.error || 'Failed to create project'));
                }
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Error creating project: ' + error.message);
            }

            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Create & Analyze Project';
        }



        // View project details
        async function viewProjectDetails(projectId) {
            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    alert('Error: Authentication token not found. Please log in again.');
                    return;
                }

                const response = await fetch(`/api/projects/${projectId}`, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                const data = await response.json();

                const modal = document.getElementById('project-details-modal');
                const content = document.getElementById('project-details-content');

                const project = data.project;
                const latestAnalysis = data.analyses && data.analyses.length > 0 ? data.analyses[0] : null;
                const milestones = data.milestones || [];
                const progress = data.progress || { progress_percentage: 0 };

                let html = `
            <h2 style="color: #667eea; margin-bottom: 20px;">${project.project_name}</h2>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <p style="margin-bottom: 15px;"><strong>Description:</strong> ${project.description}</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <p><strong>Domain:</strong> ${project.domain}</p>
                    <p><strong>Skill Level:</strong> ${project.skill_level}</p>
                    <p><strong>Time:</strong> ${project.available_time}</p>
                    <p><strong>Budget:</strong> ${project.budget}</p>
                </div>
            </div>
            
            <!-- Progress Bar -->
        <div style="margin-bottom: 30px;">
            <h3 style="margin-bottom: 10px;">Progress: ${progress.progress_percentage}%</h3>
            <div style="background: #e0e0e0; height: 30px; border-radius: 15px; overflow: hidden;">
                <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: ${progress.progress_percentage}%; transition: width 0.5s;"></div>
            </div>
            <p style="margin-top: 10px; color: #666;">${progress.current_phase || 'Not started'}</p>
        </div>
        `;

                // AI Analysis
                if (latestAnalysis) {
                    html += `
            <div style = "background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;" >
                    <h3 style="color: #1976d2; margin-bottom: 15px;">ü§ñ AI Analysis</h3>
                    <div style="margin-bottom: 10px;">
                        <strong>Feasibility Score:</strong> ${latestAnalysis.analysis_data.feasibility_score}/10
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>Next Step:</strong>
                        <div style="margin-top: 8px;">${formatAIResponse(latestAnalysis.next_step)}</div>
                    </div>

                     <button class="submit-btn" onclick="reanalyzeProject(${projectId})" style="margin-top: 10px;">
                     Re-Analyze Project
                     </button>
                </div>
            `;
                }

                // Milestones
                html += `
            <div style = "margin-bottom: 20px;" >
                <h3 style="margin-bottom: 15px;">Milestones</h3>
        `;

                milestones.forEach(milestone => {
                    const isCompleted = milestone.status === 'completed';
                    html += `
            <div style = "background: #f8f9fa; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;" >
                    <div>
                        <h4 style="margin-bottom: 5px; ${isCompleted ? 'text-decoration: line-through; color: #999;' : ''}">${milestone.milestone_name}</h4>
                        <p style="color: #666; font-size: 0.9em;">${milestone.description || ''}</p>
                    </div>
                    <div>
                        <button onclick="toggleMilestone(${projectId}, ${milestone.id}, '${milestone.status}')" 
                                style="padding: 8px 15px; background: ${isCompleted ? '#4CAF50' : '#2196F3'}; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            ${isCompleted ? '‚úì Completed' : 'Mark Complete'}
                        </button>
                    </div>
                </div>
            `;
                });

                html += `</div> `;

                // Action Buttons
                html += `
            <div style = "display: flex; gap: 10px; margin-top: 30px;" >
                <button class="submit-btn" onclick="updateProjectStatus(${projectId}, 'in_progress')">
                    ‚ñ∂ Start Project
                </button>
                <button class="submit-btn" onclick="updateProjectStatus(${projectId}, 'completed')" style="background: #4CAF50;">
                    ‚úì Mark Complete
                </button>
                <button class="submit-btn" onclick="deleteProjectConfirm(${projectId})" style="background: #f44336;">
                     Delete
                </button>
            </div>
            `;

                content.innerHTML = html;
                modal.style.display = 'block';

            } catch (error) {
                alert('Error loading project details: ' + error.message);
            }
        }

        // Close project details modal
        function closeProjectDetails() {
            document.getElementById('project-details-modal').style.display = 'none';
        }

        // Toggle milestone status
        async function toggleMilestone(projectId, milestoneId, currentStatus) {
            const newStatus = currentStatus === 'completed' ? 'pending' : 'completed';

            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    alert('Error: Authentication token not found. Please log in again.');
                    return;
                }

                const response = await fetch(`/api/projects/${projectId}/milestones/${milestoneId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                viewProjectDetails(projectId); // Refresh
            } catch (error) {
                alert('Error updating milestone: ' + error.message);
            }
        }

        // Update project status
        async function updateProjectStatus(projectId, newStatus) {
            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    alert('Error: Authentication token not found. Please log in again.');
                    return;
                }

                const response = await fetch(`/api/projects/${projectId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                closeProjectDetails();
                loadProjects();
                alert('‚úÖ Project status updated!');
            } catch (error) {
                alert('Error updating status: ' + error.message);
            }
        }

        // Re-analyze project
        async function reanalyzeProject(projectId) {
            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    alert('Error: Authentication token not found. Please log in again.');
                    return;
                }

                const response = await fetch(`/api/projects/${projectId}/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    }
                });

                const result = await response.json();
                alert('‚úÖ Project re-analyzed! Check the updated recommendations.');
                viewProjectDetails(projectId); // Refresh
            } catch (error) {
                alert('Error re-analyzing project: ' + error.message);
            }
        }

        // Delete project with confirmation
        function deleteProjectConfirm(projectId) {
            if (confirm('Are you sure you want to delete this project? This action cannot be undone.')) {
                deleteProject(projectId);
            }
        }

        async function deleteProject(projectId) {
            try {
                const token = localStorage.getItem('jwt_token');

                if (!token) {
                    alert('Error: Authentication token not found. Please log in again.');
                    return;
                }

                const response = await fetch(`/api/projects/${projectId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });

                closeProjectDetails();
                loadProjects();
                alert('‚úÖ Project deleted successfully!');
            } catch (error) {
                alert('Error deleting project: ' + error.message);
            }
        }

        // Load projects when tracker tab is opened
        // Auto-load projects when page loads
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM Content Loaded - setting up...');
            setupEventListeners();
            // Give a short delay to ensure DOM is ready
            setTimeout(() => {
                loadProjects();
            }, 500);
        });
    </script>
</body>

</html>